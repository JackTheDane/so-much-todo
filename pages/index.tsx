import Head from "next/head";
import Image from "next/image";
import styles from "@/styles/Home.module.scss";
import { ToDoItem } from "../components/ToDoItem";
import { Separator } from "../components/Separator";
import { trpc } from "../utils/trpc";
import { ToDoInput } from "../components/ToDoInput";

export default function Home() {
  const toDos = trpc.getToDos.useQuery();

  const renderToDoItems = () => {
    if (!toDos.data) {
      return <div>Loading...</div>;
    }

    const remainingToDos = toDos.data.filter(({ completed }) => !completed);

    if (!remainingToDos.length) {
      return <div>All done - GZ!</div>;
    }


    return remainingToDos.map(({ id, label, completed }) => (
      <ToDoItem key={id} id={id} checked={completed}>
        {label}
      </ToDoItem>
    ));
  };

  const renderCompletedToDos = () => {
    if (!toDos.data) return;

    const completedToDos = toDos.data.filter(({ completed }) => completed);

    if (!completedToDos.length) return;

    return (
      <>
        <h2 className={styles.header}>Done ðŸ›Œ</h2>

        <div className={styles.toDoContainer}>
          <Separator />
          {completedToDos.map(({ id, label, completed }) => (
            <ToDoItem key={id} id={id} checked={completed}>
              {label}
            </ToDoItem>
          ))}
        </div>
      </>
    );
  };

  return (
    <>
      <Head>
        <title>So much TODO!</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <h1 className={styles.header}>To-do list ðŸŽ‰</h1>

        <Separator />

        <div className={styles.toDoContainer}>
          {renderToDoItems()}
          <ToDoInput />
        </div>

        {renderCompletedToDos()}
      </main>
    </>
  );
}
